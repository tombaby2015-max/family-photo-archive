<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!--metatextblock-->
    <title>ФОТОАЛЬБОМ</title>
    <meta property="og:url" content="http://project21315616.tilda.ws" />
    <meta property="og:title" content="ФОТОАЛЬБОМ" />
    <meta property="og:description" content="" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://thb.tildacdn.ink/tild3730-6566-4766-b165-306164333335/-/resize/504x/photo-1499002238440-.jpg" />
    <link rel="canonical" href="http://project21315616.tilda.ws">
    <!--/metatextblock-->
    <meta name="format-detection" content="telephone=no" />
    <meta http-equiv="x-dns-prefetch-control" content="on">
    <link rel="dns-prefetch" href="https://ws.tildacdn.com">
    <link rel="dns-prefetch" href="https://static.tildacdn.ink">
    <meta name="robots" content="nofollow" />
    <link rel="shortcut icon" href="https://static.tildacdn.ink/img/tildafavicon.ico" type="image/x-icon" />
    <!-- Assets -->
    <script src="https://neo.tildacdn.com/js/tilda-fallback-1.0.min.js" async charset="utf-8"></script>
    <link rel="stylesheet" href="https://static.tildacdn.ink/css/tilda-grid-3.0.min.css" type="text/css" media="all" onerror="this.loaderr='y';"/>
    <link rel="stylesheet" href="https://static.tildacdn.ink/ws/project21315616/tilda-blocks-page115165096.min.css?t=1769977321" type="text/css" media="all" onerror="this.loaderr='y';" />
    <link rel="stylesheet" href="https://static.tildacdn.ink/css/tilda-cover-1.0.min.css" type="text/css" media="all" onerror="this.loaderr='y';" />
    <link rel="stylesheet" href="https://static.tildacdn.ink/css/tilda-slds-1.4.min.css" type="text/css" media="print" onload="this.media='all';" onerror="this.loaderr='y';" />
    <noscript><link rel="stylesheet" href="https://static.tildacdn.ink/css/tilda-slds-1.4.min.css" type="text/css" media="all" /></noscript>
    <link rel="stylesheet" href="https://static.tildacdn.ink/css/tilda-cards-1.0.min.css" type="text/css" media="all" onerror="this.loaderr='y';" />
    <link rel="stylesheet" href="https://static.tildacdn.ink/css/fonts-tildasans.css" type="text/css" media="all" onerror="this.loaderr='y';" />
    <script nomodule src="https://static.tildacdn.ink/js/tilda-polyfill-1.0.min.js" charset="utf-8"></script>
    <script type="text/javascript">function t_onReady(func) {if(document.readyState!='loading') {func();} else {document.addEventListener('DOMContentLoaded',func);}}
function t_onFuncLoad(funcName,okFunc,time) {if(typeof window[funcName]==='function') {okFunc();} else {setTimeout(function() {t_onFuncLoad(funcName,okFunc,time);},(time||100));}}</script>
    <script src="https://static.tildacdn.ink/js/tilda-scripts-3.0.min.js" charset="utf-8" defer onerror="this.loaderr='y';"></script>
    <script src="https://static.tildacdn.ink/ws/project21315616/tilda-blocks-page115165096.min.js?t=1769977321" charset="utf-8" async onerror="this.loaderr='y';"></script>
    <script src="https://static.tildacdn.ink/js/tilda-lazyload-1.0.min.js" charset="utf-8" async onerror="this.loaderr='y';"></script>
    <script src="https://static.tildacdn.ink/js/tilda-cover-1.0.min.js" charset="utf-8" async onerror="this.loaderr='y';"></script>
    <script src="https://static.tildacdn.ink/js/tilda-slds-1.4.min.js" charset="utf-8" async onerror="this.loaderr='y';"></script>
    <script src="https://static.tildacdn.ink/js/hammer.min.js" charset="utf-8" async onerror="this.loaderr='y';"></script>
    <script src="https://static.tildacdn.ink/js/tilda-events-1.0.min.js" charset="utf-8" async onerror="this.loaderr='y';"></script>
    <script type="text/javascript">window.dataLayer=window.dataLayer||[];</script>
    <script type="text/javascript">(function() {if((/bot|google|yandex|baidu|bing|msn|duckduckbot|teoma|slurp|crawler|spider|robot|crawling|facebook/i.test(navigator.userAgent))===false&&typeof(sessionStorage)!='undefined'&&sessionStorage.getItem('visited')!=='y'&&document.visibilityState){var style=document.createElement('style');style.type='text/css';style.innerHTML='@media screen and (min-width: 980px) {.t-records {opacity: 0;}.t-records_animated {-webkit-transition: opacity ease-in-out .2s;-moz-transition: opacity ease-in-out .2s;-o-transition: opacity ease-in-out .2s;transition: opacity ease-in-out .2s;}.t-records.t-records_visible {opacity: 1;}}';document.getElementsByTagName('head')[0].appendChild(style);function t_setvisRecs(){var alr=document.querySelectorAll('.t-records');Array.prototype.forEach.call(alr,function(el) {el.classList.add("t-records_animated");});setTimeout(function() {Array.prototype.forEach.call(alr,function(el) {el.classList.add("t-records_visible");});sessionStorage.setItem("visited","y");},400);}
document.addEventListener('DOMContentLoaded',t_setvisRecs);}})();</script>
    
    <style>
        /* Ваши оригинальные стили */
        .folder-label {
            margin-top: 15px;
            text-align: center;
            color: #000000;
            font-size: 16px;
            font-weight: bold;
        }
        .folder-count {
            text-align: center;
            color: #666;
            font-size: 14px;
            margin-top: 5px;
        }
        .t214__blockimg {
            height: 250px !important;
        }
        
        /* Стили для админки (НЕ МЕНЯЕМ ДИЗАЙН, только функциональность) */
        .admin-gear {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }
        
        .admin-gear:hover {
            background: white;
            transform: rotate(45deg);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .admin-gear svg {
            width: 24px;
            height: 24px;
            fill: #333;
        }
        
        /* Модальные окна (минимальные, без изменения дизайна) */
        .admin-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 10001;
            align-items: center;
            justify-content: center;
        }
        
        .admin-modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            text-align: center;
        }
        
        .admin-modal input {
            width: 100%;
            padding: 12px;
            margin: 20px 0;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .admin-modal button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        /* Кнопка + для добавления папки */
        .add-folder {
            position: relative;
            border: 3px dashed #ddd !important;
            background: #f9f9f9 !important;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .add-folder:hover {
            border-color: #4CAF50 !important;
            background: #f0f9f0 !important;
        }
        
        .add-folder .plus {
            font-size: 60px;
            color: #999;
            font-weight: 100;
        }
        
        .add-folder:hover .plus {
            color: #4CAF50;
        }
        
        /* Модальное окно создания папки */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 10002;
            align-items: center;
            justify-content: center;
        }
        
        .modal {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        
        .modal h3 {
            margin-top: 0;
            color: #333;
        }
        
        .modal input {
            width: 100%;
            padding: 12px;
            margin: 15px 0;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .modal-btn.primary {
            background: #4CAF50;
            color: white;
        }
        
        .modal-btn.secondary {
            background: #f5f5f5;
            color: #333;
        }
        
        /* Уведомления */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            color: white;
            z-index: 10003;
            display: none;
        }
        
        .notification.success {
            background: #4CAF50;
        }
        
        .notification.error {
            background: #f44336;
        }
        
        /* Загрузчик */
        .loader {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.8);
            z-index: 10004;
            align-items: center;
            justify-content: center;
        }
        
        .loader-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Адаптивность */
        @media (max-width: 768px) {
            .admin-gear {
                top: 10px;
                right: 10px;
                width: 40px;
                height: 40px;
            }
        }
    </style>
</head>
<body class="t-body" style="margin:0;">
    <!-- Загрузчик -->
    <div class="loader" id="loader">
        <div class="loader-spinner"></div>
    </div>
    
    <!-- Уведомления -->
    <div class="notification" id="notification"></div>
    
    <!-- Иконка админки -->
    <div class="admin-gear" id="adminGear">
        <svg viewBox="0 0 24 24">
            <path d="M12 15.5A3.5 3.5 0 0 1 8.5 12 3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5A3.5 3.5 0 0 1 12 15.5zm0-5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm6.04-3.55l-1.42-1.41-2.12 2.12a5.05 5.05 0 0 0-1.5 0L10.5 5.55l-1.42 1.41 2.12 2.12a5.05 5.05 0 0 0 0 1.5L9.08 12.5l1.42 1.41 2.12-2.12a5.05 5.05 0 0 0 1.5 0l2.12 2.12 1.41-1.42-2.12-2.12a5.05 5.05 0 0 0 0-1.5l2.12-2.12z"/>
        </svg>
    </div>
    
    <!-- Модальное окно пароля -->
    <div class="admin-modal" id="adminModal">
        <div class="admin-modal-content">
            <h2>Доступ к админке</h2>
            <p>Введите пароль для управления фотоархивом</p>
            <input type="password" id="adminPassword" placeholder="Пароль" autocomplete="off">
            <button onclick="checkPassword()">Войти</button>
            <div id="passwordError" style="color: red; margin-top: 10px; display: none;">Неверный пароль</div>
        </div>
    </div>
    
    <!-- Модальное окно создания папки -->
    <div class="modal-overlay" id="createFolderModal">
        <div class="modal">
            <h3>Создать новую папку</h3>
            <input type="text" id="folderNameInput" placeholder="Название папки" autocomplete="off">
            <div class="modal-buttons">
                <button class="modal-btn secondary" onclick="closeCreateFolderModal()">Отмена</button>
                <button class="modal-btn primary" onclick="createFolder()">Создать</button>
            </div>
        </div>
    </div>
    
    <!--allrecords-->
    <div id="allrecords" class="t-records" data-hook="blocks-collection-content-node" data-tilda-project-id="21315616" data-tilda-page-id="115165096" data-tilda-formskey="0774c3fa6873aa26fb55686221315616" data-tilda-cookie="no" data-tilda-lazy="yes" data-tilda-root-zone="one" data-tilda-project-country="AM">
        
        <!-- Заголовок (ВАШ ОРИГИНАЛЬНЫЙ ДИЗАЙН) -->
        <div id="rec1859601843" class="r t-rec" style=" " data-animationappear="off" data-record-type="18">
            <!-- cover -->
            <div class="t-cover" id="recorddiv1859601843" bgimgfield="img" style="height:100vh;background-image:url('https://thb.tildacdn.ink/tild3730-6566-4766-b165-306164333335/-/resize/20x/photo-1499002238440-.jpg');">
                <div class="t-cover__carrier" id="coverCarry1859601843" data-content-cover-id="1859601843" data-content-cover-bg="https://static.tildacdn.ink/tild3730-6566-4766-b165-306164333335/photo-1499002238440-.jpg" data-display-changed="true" data-content-cover-height="100vh" data-content-cover-parallax="fixed" data-content-use-image-for-mobile-cover="" style="height:100vh; " itemscope itemtype="http://schema.org/ImageObject"><meta itemprop="image" content="https://static.tildacdn.ink/tild3730-6566-4766-b165-306164333335/photo-1499002238440-.jpg"></div>
                <div class="t-cover__filter" style="height:100vh;background-image: linear-gradient(to bottom, rgba(0,0,0,0.30), rgba(0,0,0,0.70));"></div>
                <div class="t-container">
                    <div class="t-col t-col_12 ">
                        <div class="t-cover__wrapper t-valign_middle" style="height:100vh;">
                            <div class="t001 t-align_center">
                                <div class="t001__wrapper" data-hook-content="covercontent">
                                    <div class="t001__title t-title t-title_xl" field="title"><strong>ФОТОАЛЬБОМ</strong></div>
                                    <span class="space"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- arrow -->
                <div class="t-cover__arrow"><div class="t-cover__arrow-wrapper t-cover__arrow-wrapper_animated"><div class="t-cover__arrow_mobile"><svg role="presentation" class="t-cover__arrow-svg" style="fill:#ffffff;" x="0px" y="0px" width="38.417px" height="18.592px" viewBox="0 0 38.417 18.592" style="enable-background:new 0 0 38.417 18.592;"><g><path d="M19.208,18.592c-0.241,0-0.483-0.087-0.673-0.261L0.327,1.74c-0.408-0.372-0.438-1.004-0.066-1.413c0.372-0.409,1.004-0.439,1.413-0.066L19.208,16.24L36.743,0.261c0.411-0.372,1.042-0.342,1.413,0.066c0.372,0.408,0.343,1.041-0.065,1.413L19.881,18.332C19.691,18.505,19.449,18.592,19.208,18.592z"/></g></svg></div></div></div>
                <!-- arrow -->
            </div>
            <style> #rec1859601843 .t001__uptitle{text-transform:uppercase;}</style>
        </div>
        
        <!-- Контейнер для динамических папок -->
        <div id="dynamicAlbums"></div>
        
        <!-- Разделитель (ВАШ ОРИГИНАЛЬНЫЙ ДИЗАЙН) -->
        <div id="rec1861041833" class="r t-rec t-rec_pt_60 t-rec_pb_60" style="padding-top:60px;padding-bottom:60px; " data-record-type="363">
            <!-- T029 -->
            <div class="t029">
                <div class="t029__container t-container">
                    <div class="t029__col t-col t-col_8">
                        <div class="t029__linewrapper" style="opacity:0.2;">
                            <div class="t029__opacity t029__opacity_left" style="background-image: linear-gradient(to left, #000000, rgba(0,0,0,0));"></div>
                            <div class="t-divider t029__line" style="background: #000000;"></div>
                            <div class="t029__opacity t029__opacity_right" style="background-image: linear-gradient(to right, #000000, rgba(0,0,0,0));"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--/allrecords-->

    <!-- Футер (ВАШ ОРИГИНАЛЬНЫЙ ДИЗАЙН) -->
    <div style="text-align: center; padding: 40px; color: #666; font-size: 14px; background: #f5f5f5;">
        <div>© 2024 Личный фотоархив</div>
        <div style="margin-top: 10px; opacity: 0.6;">Для семьи и близких</div>
    </div>

    <script>
        // Конфигурация
        const CONFIG = {
            WORKER_URL: 'https://family-photos-worker.belovolov-email.workers.dev',
            ADMIN_PASSWORD: 'dima1105',
            DEFAULT_COVER: 'https://cdn4.iconfinder.com/data/icons/interface-52/100/folder-512.png',
            GITHUB_REPO: 'tombaby2015-max/family-photo-archive'
        };
        
        // Глобальные переменные
        let isAdmin = false;
        let albums = [];
        
        // Инициализация
        t_onReady(function() {
            // Проверяем сессию
            const savedSession = localStorage.getItem('photoArchiveAdmin');
            if (savedSession === CONFIG.ADMIN_PASSWORD) {
                isAdmin = true;
                updateAdminUI();
            }
            
            // Загружаем альбомы
            loadAlbums();
            
            // Назначаем обработчики
            document.getElementById('adminGear').addEventListener('click', toggleAdminAccess);
            document.getElementById('adminPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') checkPassword();
            });
            document.getElementById('folderNameInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') createFolder();
            });
        });
        
        // Обновление интерфейса админки
        function updateAdminUI() {
            const adminGear = document.getElementById('adminGear');
            if (adminGear) {
                adminGear.style.display = 'flex';
                adminGear.title = isAdmin ? 'Выйти из админки (кликните)' : 'Войти в админку';
            }
            
            // Принудительно перерисовываем альбомы
            renderAlbums();
        }
        
        // Функции уведомлений
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        function showLoader() {
            document.getElementById('loader').style.display = 'flex';
        }
        
        function hideLoader() {
            document.getElementById('loader').style.display = 'none';
        }
        
        // Админка
        function toggleAdminAccess() {
            if (isAdmin) {
                if (confirm('Выйти из админки?')) {
                    logoutAdmin();
                }
            } else {
                document.getElementById('adminModal').style.display = 'flex';
                document.getElementById('adminPassword').focus();
            }
        }
        
        function checkPassword() {
            const password = document.getElementById('adminPassword').value;
            const errorDiv = document.getElementById('passwordError');
            
            if (password === CONFIG.ADMIN_PASSWORD) {
                isAdmin = true;
                localStorage.setItem('photoArchiveAdmin', password);
                document.getElementById('adminModal').style.display = 'none';
                document.getElementById('adminPassword').value = '';
                updateAdminUI();
                showNotification('Вы вошли в админку', 'success');
            } else {
                errorDiv.style.display = 'block';
                setTimeout(() => {
                    errorDiv.style.display = 'none';
                }, 3000);
            }
        }
        
        function logoutAdmin() {
            isAdmin = false;
            localStorage.removeItem('photoArchiveAdmin');
            updateAdminUI();
            showNotification('Вы вышли из админки', 'success');
        }
        
        // Загрузка альбомов
        async function loadAlbums() {
            showLoader();
            
            try {
                // Сначала пробуем загрузить с GitHub
                const response = await fetch(`${CONFIG.WORKER_URL}/api/get-albums`);
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.status === 'success') {
                        albums = data.albums || [];
                        console.log('Загружено с GitHub:', albums.length, 'альбомов');
                        
                        // Сохраняем в localStorage как резервную копию
                        localStorage.setItem('familyPhotoAlbums', JSON.stringify(albums));
                    } else {
                        throw new Error('Ошибка в данных с GitHub');
                    }
                } else {
                    throw new Error('GitHub недоступен');
                }
            } catch (error) {
                console.log('Используем локальное хранилище:', error.message);
                
                // Загружаем из localStorage
                const saved = localStorage.getItem('familyPhotoAlbums');
                if (saved) {
                    try {
                        albums = JSON.parse(saved);
                        console.log('Загружено из localStorage:', albums.length, 'альбомов');
                    } catch (e) {
                        albums = [];
                    }
                } else {
                    albums = [];
                }
            } finally {
                renderAlbums();
                hideLoader();
            }
        }
        
        // Сохранение альбомов
        async function saveAlbums() {
            try {
                // Сохраняем в localStorage
                localStorage.setItem('familyPhotoAlbums', JSON.stringify(albums));
                
                // Пробуем сохранить на GitHub через Worker
                const response = await fetch(`${CONFIG.WORKER_URL}/api/save-albums`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ albums: albums })
                });
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    console.log('Альбомы сохранены на GitHub');
                } else {
                    console.warn('Не удалось сохранить на GitHub:', data.message);
                }
            } catch (error) {
                console.error('Ошибка сохранения:', error);
            }
        }
        
        // Отображение альбомов
        function renderAlbums() {
            const container = document.getElementById('dynamicAlbums');
            let html = '';
            
            // Очищаем контейнер
            container.innerHTML = '';
            
            // Если нет альбомов и мы не админ
            if (albums.length === 0 && !isAdmin) {
                html = `
                    <div class="r t-rec t-rec_pt_30" style="padding-top:30px; text-align: center; color: #666;">
                        <p>Пока нет ни одного альбома</p>
                        <p>Для создания альбомов войдите в админку</p>
                    </div>
                `;
                container.innerHTML = html;
                return;
            }
            
            // Группируем альбомы по 3 в строку
            for (let i = 0; i < Math.max(albums.length, 1); i += 3) {
                const rowAlbums = albums.slice(i, i + 3);
                
                html += `
                    <div class="r t-rec t-rec_pt_30" style="padding-top:30px;" data-record-type="147">
                        <div class="t214">
                            <ul class="t214__container t-card__container t-container t-container_flex">
                `;
                
                // Добавляем до 3 альбомов в строку
                for (let j = 0; j < 3; j++) {
                    const album = rowAlbums[j];
                    
                    if (album) {
                        const coverUrl = album.cover_photo ? 
                            `${CONFIG.WORKER_URL}/api/get-photo?file_id=${album.cover_photo}` : 
                            CONFIG.DEFAULT_COVER;
                        
                        html += `
                            <li class="t214__col t-item t-card__col t-col t-col_4" itemscope itemtype="http://schema.org/ImageObject">
                                <div class="t214__blockimg t-bgimg" 
                                     style="background: url('${coverUrl}') center center no-repeat; background-size:cover; cursor: pointer;"
                                     onclick="openAlbum(${album.id})">
                                </div>
                                <div class="folder-label">${album.title}</div>
                                <div class="folder-count">${album.photo_count || 0} фото</div>
                            </li>
                        `;
                    } else {
                        // Пустая ячейка
                        html += '<li class="t214__col t-item t-card__col t-col t-col_4"></li>';
                    }
                }
                
                html += '</ul></div></div>';
            }
            
            // Добавляем кнопку "+" в отдельной строке если мы админ
            if (isAdmin) {
                html += `
                    <div class="r t-rec t-rec_pt_30" style="padding-top:30px;" data-record-type="147">
                        <div class="t214">
                            <ul class="t214__container t-card__container t-container t-container_flex">
                                <li class="t214__col t-item t-card__col t-col t-col_4 add-folder" onclick="showCreateFolderModal()">
                                    <div class="t214__blockimg t-bgimg" style="background: #f9f9f9; display: flex; align-items: center; justify-content: center;">
                                        <div class="plus">+</div>
                                    </div>
                                    <div class="folder-label">Добавить папку</div>
                                </li>
                            </ul>
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }
        
        // Создание папки
        function showCreateFolderModal() {
            if (!isAdmin) {
                showNotification('Войдите в админку для создания папок', 'error');
                return;
            }
            document.getElementById('createFolderModal').style.display = 'flex';
            document.getElementById('folderNameInput').focus();
        }
        
        function closeCreateFolderModal() {
            document.getElementById('createFolderModal').style.display = 'none';
            document.getElementById('folderNameInput').value = '';
        }
        
        async function createFolder() {
            const folderName = document.getElementById('folderNameInput').value.trim();
            
            if (!folderName) {
                showNotification('Введите название папки', 'error');
                return;
            }
            
            showLoader();
            
            try {
                // Создаём тему в Telegram через Worker
                const response = await fetch(`${CONFIG.WORKER_URL}/api/create-topic`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title: folderName })
                });
                
                const data = await response.json();
                
                if (data.status !== 'success') {
                    throw new Error(data.message || 'Ошибка создания темы');
                }
                
                // Добавляем в локальный массив
                const newAlbum = {
                    id: data.topic_id,
                    title: folderName,
                    cover_photo: null,
                    photo_count: 0,
                    photos: [],
                    created_at: new Date().toISOString()
                };
                
                albums.push(newAlbum);
                
                // Сохраняем
                await saveAlbums();
                
                // Обновляем отображение
                renderAlbums();
                
                // Закрываем модальное окно
                closeCreateFolderModal();
                
                // Показываем уведомление
                showNotification(`Папка "${folderName}" создана!`, 'success');
                
            } catch (error) {
                console.error('Ошибка:', error);
                showNotification(`Ошибка: ${error.message}`, 'error');
            } finally {
                hideLoader();
            }
        }
        
        function openAlbum(albumId) {
            // Находим альбом
            const album = albums.find(a => parseInt(a.id) === parseInt(albumId));
            if (!album) {
                showNotification('Альбом не найден', 'error');
                return;
            }
            
            // Переходим на страницу галереи
            window.location.href = `album.html?id=${albumId}&title=${encodeURIComponent(album.title)}`;
        }
    </script>
</body>
</html>
